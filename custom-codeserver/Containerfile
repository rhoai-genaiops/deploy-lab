# FROM registry.redhat.io/rhoai/odh-workbench-codeserver-datascience-cpu-py312-rhel9@sha256:2fbf4b2214fc6136fce252d81d3d51c6316830aacf95f8398f89e08bde50f766
FROM registry.redhat.io/rhoai/odh-workbench-codeserver-datascience-cpu-py312-rhel9@sha256:0c222e02ac68a3d4b7db535a168c959ae44992767b64c405d72c531624c60bc1

ADD . .

RUN pip install --no-deps -r frozen-requirements.txt --extra-index-url https://download.pytorch.org/whl/cpu

# COPY settings.json /opt/app-root/src/.vscode/settings.json

USER root
COPY run-code-server.sh /opt/app-root/bin/run-code-server.sh
COPY startup.sh /opt/app-root/bin/startup.sh
RUN chmod +x /opt/app-root/bin/run-code-server.sh /opt/app-root/bin/startup.sh

# kubeseal
RUN curl -sL https://github.com/bitnami-labs/sealed-secrets/releases/download/v0.29.0/kubeseal-0.29.0-linux-amd64.tar.gz | tar --no-same-owner -xzf - -C /usr/local/bin kubeseal && \
    chmod -R 755 /usr/local/bin/kubeseal


USER 1001
ENTRYPOINT [ "startup.sh" ]
